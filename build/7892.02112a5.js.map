{"version":3,"file":"7892.02112a5.js","mappings":"qOAMA,MAAMA,EAAuB,sBAItB,MAAMC,EACTC,YAAYC,GACRC,KAAKC,qBAAuBL,EAC5BI,KAAKC,sBACAF,GAAW,IAAIG,qBAAuBN,EAC3CI,KAAKG,SAAWH,KAAKI,yBAKzBA,yBACI,OAAO,mBAA2B,CAC9BC,KAAML,KAAKC,qBACXK,YAAa,+BACbC,UAAW,WACXC,QAAS,IASjBC,UAAUC,GAGN,IAAIC,SAFcX,KAAKY,UACFC,SACAC,MAAMC,GAChBA,EAAQC,KAAON,IAK1B,OAHKC,IACDA,QAAcX,KAAKiB,cAAcP,IAE9BC,EAKXF,eACI,IAAIS,EACJ,MAAMC,EAA6D,QAA9CD,EAAK,EAAAE,WAAA,UAAqB,sBAAmC,IAAPF,EAAgBA,EAAK,IAC1FG,cAAoBC,MAAM,EAAAC,OAAA,KAAYJ,EAAa,cAAcK,OACjEX,QAAiBY,QAAQJ,IAAIA,EAAIK,KAAIjB,MAAOkB,IAC9C,IAAIT,EACJ,MAAM,GAAEF,GAAOW,EACTC,EAAmD,QAA5CV,QAAYlB,KAAKG,SAAS0B,QAAQb,UAAyB,IAAPE,EAAgBA,EAAKS,EAAOC,IAC7F,MAAO,IACAE,EAAQC,SAASJ,GACpBC,IAAAA,EACAf,SAAU,QAAYe,QAG9B,MAAO,CAAEf,SAAAA,GASbJ,WAAWC,EAAUkB,SACX5B,KAAKG,SAAS6B,QAAQtB,EAAUkB,GAO1CnB,oBAAoBC,GAChB,IAAIQ,EACJ,MAAOe,EAAaC,GAAcxB,EAASyB,MAAM,KACjD,IAAKL,EAAQM,YAAYH,GACrB,OAEJ,MAAMI,EAAmB,EAAAjB,WAAA,UAAqB,wBACxCkB,EAAY,EAAAf,OAAA,KAAYc,EAAkBJ,EAAa,UAAWA,EAAa,GAAGC,UAClFK,EAAa,EAAAhB,OAAA,KAAYc,EAAkBJ,EAAa,gBACxDO,cAAsBlB,MAAMgB,IAAYd,OACxCiB,cAA2BnB,MAAMiB,IAAaf,OAC9CI,EAAyD,QAAlDV,QAAYlB,KAAKG,SAAS0B,QAAQnB,UAA+B,IAAPQ,EAAgBA,EAAK,KACtFL,EAAW,QAAYe,IAAQ,GACrC,OAAOE,EAAQC,SAAS,CACpBf,GAAIN,EACJkB,IAAAA,EACAY,OAAAA,EACA3B,SAAAA,EACAL,QAASiC,EAAYjC,SAAW,WAO5C,IAAIsB,GACJ,SAAWA,GACP,MAAMY,EAAaC,KAAKC,MAAM,EAAAxB,WAAA,UAAqB,sBAAwB,MAqB3EU,EAAQM,YAfR,SAAqBH,GACjB,IAAIY,EACJ,IACIA,EAAYF,KAAKC,MAAM,EAAAxB,WAAA,UAAqB,yBAEhD,MACI,OAAO,EAEX,IAAK,MAAM,KAAEf,KAAUwC,EACnB,GAAIxC,IAAS4B,EACT,OAAO,EAGf,OAAO,GAoBXH,EAAQC,SAZR,SAAkBJ,GACd,GAAIe,EAAWf,EAAOX,IAAK,CAClBW,EAAOa,OAAOM,aAEfnB,EAAOa,OAAOM,WAAa,IAE/B,IAAK,MAAOC,EAAMC,KAAgBC,OAAOC,QAAQR,EAAWf,EAAOX,KAAO,IACtEW,EAAOa,OAAOM,WAAWC,GAAMI,QAAUH,EAGjD,OAAOrB,GAtCf,CAyCGG,IAAYA,EAAU,KC9IlB,MAAMsB,EAAY,I,SAAIC,OAAM","sources":["webpack://_JUPYTERLAB.CORE_OUTPUT/../packages/settings/lib/settings.js","webpack://_JUPYTERLAB.CORE_OUTPUT/../packages/settings/lib/tokens.js"],"sourcesContent":["import { PageConfig, URLExt } from '@jupyterlab/coreutils';\nimport * as json5 from 'json5';\nimport localforage from 'localforage';\n/**\n * The name of the local storage.\n */\nconst DEFAULT_STORAGE_NAME = 'JupyterLite Storage';\n/**\n * A class to handle requests to /api/settings\n */\nexport class Settings {\n    constructor(options) {\n        this._settingsStorageName = DEFAULT_STORAGE_NAME;\n        this._settingsStorageName =\n            (options || {}).settingsStorageName || DEFAULT_STORAGE_NAME;\n        this._storage = this.defaultSettingsStorage();\n    }\n    /**\n     * Create a settings store.\n     */\n    defaultSettingsStorage() {\n        return localforage.createInstance({\n            name: this._settingsStorageName,\n            description: 'Offline Storage for Settings',\n            storeName: 'settings',\n            version: 1,\n        });\n    }\n    /**\n     * Get settings by plugin id\n     *\n     * @param pluginId the id of the plugin\n     *\n     */\n    async get(pluginId) {\n        const all = await this.getAll();\n        const settings = all.settings;\n        let found = settings.find((setting) => {\n            return setting.id === pluginId;\n        });\n        if (!found) {\n            found = await this._getFederated(pluginId);\n        }\n        return found;\n    }\n    /**\n     * Get all the settings\n     */\n    async getAll() {\n        var _a;\n        const settingsUrl = (_a = PageConfig.getOption('settingsUrl')) !== null && _a !== void 0 ? _a : '/';\n        const all = (await (await fetch(URLExt.join(settingsUrl, 'all.json'))).json());\n        const settings = await Promise.all(all.map(async (plugin) => {\n            var _a;\n            const { id } = plugin;\n            const raw = (_a = (await this._storage.getItem(id))) !== null && _a !== void 0 ? _a : plugin.raw;\n            return {\n                ...Private.override(plugin),\n                raw,\n                settings: json5.parse(raw),\n            };\n        }));\n        return { settings };\n    }\n    /**\n     * Save settings for a given plugin id\n     *\n     * @param pluginId The id of the plugin\n     * @param raw The raw settings\n     *\n     */\n    async save(pluginId, raw) {\n        await this._storage.setItem(pluginId, raw);\n    }\n    /**\n     * Get the settings for a federated extension\n     *\n     * @param pluginId The id of a plugin\n     */\n    async _getFederated(pluginId) {\n        var _a;\n        const [packageName, schemaName] = pluginId.split(':');\n        if (!Private.isFederated(packageName)) {\n            return;\n        }\n        const labExtensionsUrl = PageConfig.getOption('fullLabextensionsUrl');\n        const schemaUrl = URLExt.join(labExtensionsUrl, packageName, 'schemas', packageName, `${schemaName}.json`);\n        const packageUrl = URLExt.join(labExtensionsUrl, packageName, 'package.json');\n        const schema = await (await fetch(schemaUrl)).json();\n        const packageJson = await (await fetch(packageUrl)).json();\n        const raw = (_a = (await this._storage.getItem(pluginId))) !== null && _a !== void 0 ? _a : '{}';\n        const settings = json5.parse(raw) || {};\n        return Private.override({\n            id: pluginId,\n            raw,\n            schema,\n            settings,\n            version: packageJson.version || '3.0.8',\n        });\n    }\n}\n/**\n * A namespace for private data\n */\nvar Private;\n(function (Private) {\n    const _overrides = JSON.parse(PageConfig.getOption('settingsOverrides') || '{}');\n    /**\n     * Test whether this package is configured in `federated_extensions` in this app\n     *\n     * @param packageName The npm name of a package\n     */\n    function isFederated(packageName) {\n        let federated;\n        try {\n            federated = JSON.parse(PageConfig.getOption('federated_extensions'));\n        }\n        catch {\n            return false;\n        }\n        for (const { name } of federated) {\n            if (name === packageName) {\n                return true;\n            }\n        }\n        return false;\n    }\n    Private.isFederated = isFederated;\n    /**\n     * Override the defaults of the schema with ones from PageConfig\n     *\n     * @see https://github.com/jupyterlab/jupyterlab_server/blob/v2.5.2/jupyterlab_server/settings_handler.py#L216-L227\n     */\n    function override(plugin) {\n        if (_overrides[plugin.id]) {\n            if (!plugin.schema.properties) {\n                // probably malformed, or only provides keyboard shortcuts, etc.\n                plugin.schema.properties = {};\n            }\n            for (const [prop, propDefault] of Object.entries(_overrides[plugin.id] || {})) {\n                plugin.schema.properties[prop].default = propDefault;\n            }\n        }\n        return plugin;\n    }\n    Private.override = override;\n})(Private || (Private = {}));\n","import { Token } from '@lumino/coreutils';\n/**\n * The token for the settings service.\n */\nexport const ISettings = new Token('@jupyterlite/settings:ISettings');\n"],"names":["DEFAULT_STORAGE_NAME","Settings","constructor","options","this","_settingsStorageName","settingsStorageName","_storage","defaultSettingsStorage","name","description","storeName","version","async","pluginId","found","getAll","settings","find","setting","id","_getFederated","_a","settingsUrl","PageConfig","all","fetch","URLExt","json","Promise","map","plugin","raw","getItem","Private","override","setItem","packageName","schemaName","split","isFederated","labExtensionsUrl","schemaUrl","packageUrl","schema","packageJson","_overrides","JSON","parse","federated","properties","prop","propDefault","Object","entries","default","ISettings","Token"],"sourceRoot":""}